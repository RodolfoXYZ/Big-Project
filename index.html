<!DOCTYPE html>
<html lang="PT-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <title>Gráficos</title>
</head>
<body>
    <input type="file" id="csvFile1" accept=".csv">
    <input type="file" id="csvFile2" accept=".csv">
    <table id="dataTable"></table>
    <div id="myChart" style="width: 600px; height: 400px;"></div>
    <div id="combinedChart" style="width: 600px; height: 400px;"></div>
    <div id="ageComparisonChart" style="width: 800px; height: 400px;"></div> <!-- Gráfico de comparação -->

    <script>
        google.charts.load('current', { 'packages': ['corechart'] });

        const idade1 = {  
            '15-25': 0,
            '25-35': 0,
            '35-45': 0,
            '45-55': 0,
            '55-65': 0,
            '65-75': 0,
            '75-85': 0,
        };

        const idade2 = {  
            '15-25': 0,
            '25-35': 0,
            '35-45': 0,
            '45-55': 0,
            '55-65': 0,
            '65-75': 0,
            '75-85': 0,
        };

        document.getElementById('csvFile1').addEventListener('change', function (event) {
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const csvData = e.target.result;
                    processData(csvData, idade1);
                    drawChart1();
                };
                reader.readAsText(file);
            }
        });

        document.getElementById('csvFile2').addEventListener('change', function (event) {
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const csvData = e.target.result;
                    processData(csvData, idade2);
                    drawChart2();
                };
                reader.readAsText(file);
            }
        });

        function processData(csvData, idade) {
            const lines = csvData.split('\n');
            const table = document.getElementById('dataTable');
            table.innerHTML = '';

            for (let i = 0; i < lines.length; i++) {
                const row = table.insertRow(-1);
                const cells = lines[i].split(',');

                const age = parseInt(cells[2], 10);

                if (!isNaN(age)) {
                    if (age >= 15 && age < 25) {
                        idade['15-25']++;
                    } else if (age >= 25 && age < 35) {
                        idade['25-35']++;
                    } else if (age >= 35 && age < 45) {
                        idade['35-45']++;
                    } else if (age >= 45 && age < 55) {
                        idade['45-55']++;
                    } else if (age >= 55 && age < 65) {
                        idade['55-65']++;
                    } else if (age >= 65 && age < 75) {
                        idade['65-75']++;
                    } else if (age >= 75 && age < 85) {
                        idade['75-85']++;
                    }
                }

                for (let j = 0; j < cells.length; j++) {
                    const cell = row.insertCell(-1);
                    cell.innerHTML = cells[j];
                }
            }
        }

        function drawChart1() {
            const data1 = google.visualization.arrayToDataTable([
                ['Idade', 'Quantidade'],
                ['15-25', idade1['15-25']],
                ['25-35', idade1['25-35']],
                ['35-45', idade1['35-45']],
                ['45-55', idade1['45-55']],
                ['55-65', idade1['55-65']],
                ['65-75', idade1['65-75']],
                ['75-85', idade1['75-85']],
            ]);

            const options1 = {
                title: 'Dados do Arquivo 1',
                hAxis: { title: 'Idade' },
                vAxis: { title: 'Quantidade' },
            };

            const chart1 = new google.visualization.ColumnChart(document.getElementById('myChart'));
            chart1.draw(data1, options1);
        }

        function drawChart2() {
            const data2 = google.visualization.arrayToDataTable([
                ['Idade', 'Quantidade'],
                ['15-25', idade2['15-25']],
                ['25-35', idade2['25-35']],
                ['35-45', idade2['35-45']],
                ['45-55', idade2['45-55']],
                ['55-65', idade2['55-65']],
                ['65-75', idade2['65-75']],
                ['75-85', idade2['75-85']],
            ]);

            const options2 = {
                title: 'Dados do Arquivo 2',
                hAxis: { title: 'Idade' },
                vAxis: { title: 'Quantidade' },
            };

            const chart2 = new google.visualization.ColumnChart(document.getElementById('combinedChart'));
            chart2.draw(data2, options2);
            drawComparisonChart(); // Mostra o gráfico de comparação após o gráfico 2
        }

        function drawComparisonChart() {
            const dataComparison = google.visualization.arrayToDataTable([
                ['Idade', 'CSV 1', 'CSV 2'],
                ['15-25', idade1['15-25'], idade2['15-25']],
                ['25-35', idade1['25-35'], idade2['25-35']],
                ['35-45', idade1['35-45'], idade2['35-45']],
                ['45-55', idade1['45-55'], idade2['45-55']],
                ['55-65', idade1['55-65'], idade2['55-65']],
                ['65-75', idade1['65-75'], idade2['65-75']],
                ['75-85', idade1['75-85'], idade2['75-85']],
            ]);

            const optionsComparison = {
                title: 'Comparação de Idades entre CSV 1 e CSV 2',
                isStacked: true,
            };

            const chartComparison = new google.visualization.ColumnChart(document.getElementById('ageComparisonChart'));
            chartComparison.draw(dataComparison, optionsComparison);
        }
    </script>
</body>
</html>
